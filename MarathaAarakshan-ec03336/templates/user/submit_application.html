{% extends "base.html" %}

{% block title %}‡§®‡§µ‡§æ ‡§Ö‡§∞‡•ç‡§ú - ‡§Æ‡§∞‡§æ‡§†‡§æ ‡§Ü‡§∞‡§ï‡•ç‡§∑‡§£ ‡§Æ‡§Ç‡§ö{% endblock %}

{% block content %}
<div class="container py-5">
    <!-- Header -->
    <div class="row mb-4">
        <div class="col-12 text-center">
            <h1 class="display-6 text-primary">üìù ‡§®‡§µ‡§æ ‡§Ö‡§∞‡•ç‡§ú ‡§∏‡§¨‡§Æ‡§ø‡§ü ‡§ï‡§∞‡§æ</h1>
            <p class="text-muted">‡§ï‡•Å‡§£‡§¨‡•Ä ‡§™‡•ç‡§∞‡§Æ‡§æ‡§£‡§™‡§§‡•ç‡§∞‡§æ‡§∏‡§æ‡§†‡•Ä ‡§Ö‡§∞‡•ç‡§ú ‡§≠‡§∞‡§æ</p>
        </div>
    </div>

    <!-- Application Form -->
    <div class="row">
        <div class="col-lg-8 mx-auto">
            <div class="card border-0 shadow">
                <div class="card-header bg-primary text-white">
                    <h5 class="mb-0">
                        <i class="fas fa-file-alt me-2"></i>‡§Ö‡§∞‡•ç‡§ú ‡§´‡•â‡§∞‡•ç‡§Æ
                    </h5>
                </div>
                <div class="card-body">
                    <form method="POST" action="{% url 'applications:submit_application' %}">
                        <!-- Personal Information -->
                        <div class="mb-4">
                            <h6 class="text-primary">‡§µ‡•à‡§Ø‡§ï‡•ç‡§§‡§ø‡§ï ‡§Æ‡§æ‡§π‡§ø‡§§‡•Ä</h6>
                            <hr>
                        </div>

                        <div class="row">
                            <div class="col-md-6 mb-3">
                                <label for="applicant_name" class="form-label">‡§Ö‡§∞‡•ç‡§ú‡§¶‡§æ‡§∞‡§æ‡§ö‡•á ‡§®‡§æ‡§µ <span class="text-danger">*</span></label>
                                <input type="text" class="form-control" id="applicant_name" name="applicant_name" required>
                            </div>
                            <div class="col-md-6 mb-3">
                                <label for="applicant_surname" class="form-label">‡§Ü‡§°‡§®‡§æ‡§µ <span class="text-danger">*</span></label>
                                <input type="text" class="form-control" id="applicant_surname" name="applicant_surname" required>
                            </div>
                        </div>

                        <div class="row">
                            <div class="col-md-6 mb-3">
                                <label for="birth_year" class="form-label">‡§ú‡§®‡•ç‡§Æ ‡§µ‡§∞‡•ç‡§∑</label>
                                <input type="number" class="form-control" id="birth_year" name="birth_year" min="1920" max="2020">
                            </div>
                            <div class="col-md-6 mb-3">
                                <label for="contact_number" class="form-label">‡§∏‡§Ç‡§™‡§∞‡•ç‡§ï ‡§ï‡•ç‡§∞‡§Æ‡§æ‡§Ç‡§ï <span class="text-danger">*</span></label>
                                <input type="tel" class="form-control" id="contact_number" name="contact_number" pattern="[0-9]{10}" required>
                            </div>
                        </div>

                        <!-- Location Information -->
                        <div class="mb-4">
                            <h6 class="text-primary">‡§∏‡•ç‡§•‡§æ‡§® ‡§Æ‡§æ‡§π‡§ø‡§§‡•Ä</h6>
                            <hr>
                        </div>

                        <div class="row">
                            <div class="col-md-4 mb-3">
                                <label for="division_id" class="form-label">‡§µ‡§ø‡§≠‡§æ‡§ó <span class="text-danger">*</span></label>
                                <select class="form-select" id="division_id" name="division_id" required>
                                    <option value="">‡§µ‡§ø‡§≠‡§æ‡§ó ‡§®‡§ø‡§µ‡§°‡§æ</option>
                                    {% for division in divisions %}
                                    <option value="{{ division.id }}">{{ division.name }}</option>
                                    {% endfor %}
                                </select>
                            </div>
                            <div class="col-md-4 mb-3">
                                <label for="district_id" class="form-label">‡§ú‡§ø‡§≤‡•ç‡§π‡§æ <span class="text-danger">*</span></label>
                                <select class="form-select" id="district_id" name="district_id" disabled required>
                                    <option value="">‡§™‡§π‡§ø‡§≤‡•á ‡§µ‡§ø‡§≠‡§æ‡§ó ‡§®‡§ø‡§µ‡§°‡§æ</option>
                                </select>
                            </div>
                            <div class="col-md-4 mb-3">
                                <label for="village_id" class="form-label">‡§ó‡§æ‡§µ <span class="text-danger">*</span></label>
                                <select class="form-select" id="village_id" name="village_id" disabled required>
                                    <option value="">‡§™‡§π‡§ø‡§≤‡•á ‡§ú‡§ø‡§≤‡•ç‡§π‡§æ ‡§®‡§ø‡§µ‡§°‡§æ</option>
                                </select>
                            </div>
                        </div>

                        <!-- Application Type -->
                        <div class="mb-4">
                            <h6 class="text-primary">‡§Ö‡§∞‡•ç‡§ú‡§æ‡§ö‡§æ ‡§™‡•ç‡§∞‡§ï‡§æ‡§∞</h6>
                            <hr>
                        </div>

                        <div class="row">
                            <div class="col-12 mb-3">
                                <div class="card bg-light">
                                    <div class="card-body">
                                        <div class="form-check">
                                            <input class="form-check-input" type="radio" name="application_type" id="fresh_application" value="fresh" checked>
                                            <label class="form-check-label" for="fresh_application">
                                                <strong>‡§®‡§µ‡•Ä‡§® ‡§Ö‡§∞‡•ç‡§ú</strong> - ‡§™‡§π‡§ø‡§≤‡•ç‡§Ø‡§æ‡§Ç‡§¶‡§æ ‡§Ö‡§∞‡•ç‡§ú ‡§ï‡§∞‡§§ ‡§Ü‡§π‡§æ‡§§
                                            </label>
                                        </div>
                                        <div class="form-check">
                                            <input class="form-check-input" type="radio" name="application_type" id="reapplication" value="reapplication">
                                            <label class="form-check-label" for="reapplication">
                                                <strong>‡§™‡•Å‡§®‡§∞‡•ç‡§Ö‡§∞‡•ç‡§ú</strong> - ‡§™‡•Ç‡§∞‡•ç‡§µ‡•Ä‡§ö‡§æ ‡§Ö‡§∞‡•ç‡§ú ‡§®‡§æ‡§ï‡§æ‡§∞‡§≤‡§æ ‡§ó‡•á‡§≤‡§æ ‡§π‡•ã‡§§‡§æ
                                            </label>
                                        </div>
                                    </div>
                                </div>
                            </div>
                        </div>

                        <!-- Documents Checklist -->
                        <div class="mb-4">
                            <h6 class="text-primary">‡§Ü‡§µ‡§∂‡•ç‡§Ø‡§ï ‡§ï‡§æ‡§ó‡§¶‡§™‡§§‡•ç‡§∞‡•á</h6>
                            <hr>
                            <div class="alert alert-info">
                                <strong>‡§∏‡•Ç‡§ö‡§®‡§æ:</strong> ‡§ñ‡§æ‡§≤‡•Ä‡§≤ ‡§ï‡§æ‡§ó‡§¶‡§™‡§§‡•ç‡§∞‡•á ‡§§‡•Å‡§Æ‡§ö‡•ç‡§Ø‡§æ‡§ï‡§°‡•á ‡§§‡§Ø‡§æ‡§∞ ‡§Ö‡§∏‡§æ‡§µ‡•Ä‡§§
                            </div>
                        </div>

                        <div class="row">
                            <div class="col-12 mb-3">
                                <div class="checklist">
                                    <div class="form-check">
                                        <input class="form-check-input" type="checkbox" id="doc1" required>
                                        <label class="form-check-label" for="doc1">
                                            ‡§ú‡§®‡•ç‡§Æ ‡§™‡•ç‡§∞‡§Æ‡§æ‡§£‡§™‡§§‡•ç‡§∞ (‡§ú‡§æ‡§§ ‡§®‡§Æ‡•Ç‡§¶ ‡§Ö‡§∏‡§≤‡•á‡§≤‡•á)
                                        </label>
                                    </div>
                                    <div class="form-check">
                                        <input class="form-check-input" type="checkbox" id="doc2" required>
                                        <label class="form-check-label" for="doc2">
                                            ‡•≠/‡•ß‡•® ‡§â‡§§‡§æ‡§∞‡§æ (‡§∂‡•á‡§§‡§ú‡§Æ‡§ø‡§®‡•Ä‡§ö‡§æ ‡§¶‡§æ‡§ñ‡§≤‡§æ)
                                        </label>
                                    </div>
                                    <div class="form-check">
                                        <input class="form-check-input" type="checkbox" id="doc3" required>
                                        <label class="form-check-label" for="doc3">
                                            ‡§®‡§ø‡§µ‡§æ‡§∏‡•Ä ‡§¶‡§æ‡§ñ‡§≤‡§æ (‡•ß‡•© ‡§ë‡§ï‡•ç‡§ü‡•ã‡§¨‡§∞ ‡•ß‡•Ø‡•¨‡•≠ ‡§™‡•Ç‡§∞‡•ç‡§µ‡•Ä‡§ö‡§æ)
                                        </label>
                                    </div>
                                    <div class="form-check">
                                        <input class="form-check-input" type="checkbox" id="doc4">
                                        <label class="form-check-label" for="doc4">
                                            ‡§®‡§æ‡§§‡•á‡§µ‡§æ‡§à‡§ï‡§æ‡§Ç‡§ö‡•á ‡§ï‡•Å‡§£‡§¨‡•Ä ‡§™‡•ç‡§∞‡§Æ‡§æ‡§£‡§™‡§§‡•ç‡§∞ (‡§Ö‡§∏‡§≤‡•ç‡§Ø‡§æ‡§∏)
                                        </label>
                                    </div>
                                    <div class="form-check">
                                        <input class="form-check-input" type="checkbox" id="doc5">
                                        <label class="form-check-label" for="doc5">
                                            ‡§∂‡§æ‡§≥‡§æ ‡§¶‡§æ‡§ñ‡§≤‡•á (‡§ú‡§æ‡§§ ‡§®‡§Æ‡•Ç‡§¶ ‡§Ö‡§∏‡§≤‡•á‡§≤‡•á)
                                        </label>
                                    </div>
                                </div>
                            </div>
                        </div>

                        <!-- Declaration -->
                        <div class="mb-4">
                            <h6 class="text-primary">‡§ò‡•ã‡§∑‡§£‡§æ‡§™‡§§‡•ç‡§∞</h6>
                            <hr>
                        </div>

                        <div class="alert alert-warning">
                            <div class="form-check">
                                <input class="form-check-input" type="checkbox" id="declaration" required>
                                <label class="form-check-label" for="declaration">
                                    ‡§Æ‡•Ä ‡§ò‡•ã‡§∑‡§£‡§æ ‡§ï‡§∞‡§§‡•ã/‡§ï‡§∞‡§§‡•á ‡§ï‡•Ä ‡§µ‡§∞‡•Ä‡§≤ ‡§∏‡§∞‡•ç‡§µ ‡§Æ‡§æ‡§π‡§ø‡§§‡•Ä ‡§ñ‡§∞‡•Ä ‡§Ü‡§π‡•á. ‡§¨‡§®‡§æ‡§µ‡§ü ‡§ï‡§æ‡§ó‡§¶‡§™‡§§‡•ç‡§∞‡•á ‡§¶‡•á‡§£‡•á ‡§π‡§æ ‡§ó‡•Å‡§®‡•ç‡§π‡§æ ‡§Ü‡§π‡•á ‡§Ü‡§£‡§ø ‡§§‡•ç‡§Ø‡§æ‡§∏‡§æ‡§†‡•Ä ‡§ï‡§æ‡§Ø‡§¶‡•á‡§∂‡•Ä‡§∞ ‡§ï‡§æ‡§∞‡§µ‡§æ‡§à ‡§π‡•ã‡§ä ‡§∂‡§ï‡§§‡•á.
                                </label>
                            </div>
                        </div>

                        <!-- Submit Button -->
                        <div class="text-center">
                            <button type="submit" class="btn btn-success btn-lg">
                                <i class="fas fa-paper-plane me-2"></i>‡§Ö‡§∞‡•ç‡§ú ‡§∏‡§¨‡§Æ‡§ø‡§ü ‡§ï‡§∞‡§æ
                            </button>
                        </div>
                    </form>
                </div>
            </div>
        </div>
    </div>

    <!-- Help Section -->
    <div class="row mt-5">
        <div class="col-12">
            <div class="card bg-light border-0">
                <div class="card-body">
                    <h5 class="text-primary">‡§Æ‡§¶‡§§‡•Ä‡§ö‡•Ä ‡§ó‡§∞‡§ú?</h5>
                    <div class="row">
                        <div class="col-md-4">
                            <p><i class="fas fa-book text-info me-2"></i><a href="{% url 'core:guide' %}">‡§∏‡§Ç‡§™‡•Ç‡§∞‡•ç‡§£ ‡§Æ‡§æ‡§∞‡•ç‡§ó‡§¶‡§∞‡•ç‡§∂‡§ï ‡§µ‡§æ‡§ö‡§æ</a></p>
                        </div>
                        <div class="col-md-4">
                            <p><i class="fas fa-phone text-success me-2"></i><a href="tel:+919876543210">‡§π‡•á‡§≤‡•ç‡§™‡§≤‡§æ‡§á‡§®: +91 98765 43210</a></p>
                        </div>
                        <div class="col-md-4">
                            <p><i class="fas fa-question-circle text-warning me-2"></i><a href="{% url 'core:faq' %}">‡§µ‡§æ‡§∞‡§Ç‡§µ‡§æ‡§∞ ‡§µ‡§ø‡§ö‡§æ‡§∞‡§≤‡•á ‡§ú‡§æ‡§£‡§æ‡§∞‡•á ‡§™‡•ç‡§∞‡§∂‡•ç‡§®</a></p>
                        </div>
                    </div>
                </div>
            </div>
        </div>
    </div>
</div>
{% endblock %}

{% block scripts %}
<script>
// Location cascade
document.getElementById('division_id').addEventListener('change', function() {
    const divisionId = this.value;
    const districtSelect = document.getElementById('district_id');
    const villageSelect = document.getElementById('village_id');
    
    districtSelect.innerHTML = '<option value="">‡§≤‡•ã‡§° ‡§π‡•ã ‡§∞‡§π‡§æ ‡§π‡•à...</option>';
    districtSelect.disabled = true;
    villageSelect.innerHTML = '<option value="">‡§™‡§π‡§ø‡§≤‡•á ‡§ú‡§ø‡§≤‡•ç‡§π‡§æ ‡§®‡§ø‡§µ‡§°‡§æ</option>';
    villageSelect.disabled = true;

    if (divisionId) {
        fetch(`/api/districts/${divisionId}`)
            .then(response => response.json())
            .then(districts => {
                districtSelect.innerHTML = '<option value="">‡§ú‡§ø‡§≤‡•ç‡§π‡§æ ‡§®‡§ø‡§µ‡§°‡§æ</option>';
                districts.forEach(district => {
                    districtSelect.innerHTML += `<option value="${district.id}">${district.name}</option>`;
                });
                districtSelect.disabled = false;
            });
    } else {
        districtSelect.innerHTML = '<option value="">‡§™‡§π‡§ø‡§≤‡•á ‡§µ‡§ø‡§≠‡§æ‡§ó ‡§®‡§ø‡§µ‡§°‡§æ</option>';
    }
});

document.getElementById('district_id').addEventListener('change', function() {
    const districtId = this.value;
    const villageSelect = document.getElementById('village_id');
    
    villageSelect.innerHTML = '<option value="">‡§≤‡•ã‡§° ‡§π‡•ã ‡§∞‡§π‡§æ ‡§π‡•à...</option>';
    villageSelect.disabled = true;

    if (districtId) {
        fetch(`/api/villages/${districtId}`)
            .then(response => response.json())
            .then(villages => {
                villageSelect.innerHTML = '<option value="">‡§ó‡§æ‡§µ ‡§®‡§ø‡§µ‡§°‡§æ</option>';
                villages.forEach(village => {
                    villageSelect.innerHTML += `<option value="${village.id}">${village.name}</option>`;
                });
                villageSelect.disabled = false;
            });
    } else {
        villageSelect.innerHTML = '<option value="">‡§™‡§π‡§ø‡§≤‡•á ‡§ú‡§ø‡§≤‡•ç‡§π‡§æ ‡§®‡§ø‡§µ‡§°‡§æ</option>';
    }
});

// Phone number formatting
document.getElementById('contact_number').addEventListener('input', function() {
    let value = this.value.replace(/\D/g, '');
    if (value.length > 10) value = value.slice(0, 10);
    this.value = value;
});

// Form validation
document.querySelector('form').addEventListener('submit', function(e) {
    const requiredDocs = document.querySelectorAll('input[type="checkbox"][required]');
    const uncheckedRequired = Array.from(requiredDocs).filter(checkbox => !checkbox.checked);
    
    if (uncheckedRequired.length > 0) {
        e.preventDefault();
        alert('‡§ï‡•É‡§™‡§Ø‡§æ ‡§∏‡§∞‡•ç‡§µ ‡§Ü‡§µ‡§∂‡•ç‡§Ø‡§ï ‡§ï‡§æ‡§ó‡§¶‡§™‡§§‡•ç‡§∞‡•á ‡§§‡§Ø‡§æ‡§∞ ‡§Ö‡§∏‡§≤‡•ç‡§Ø‡§æ‡§ö‡•Ä ‡§™‡•Å‡§∑‡•ç‡§ü‡•Ä ‡§ï‡§∞‡§æ');
        return;
    }
    
    if (!document.getElementById('declaration').checked) {
        e.preventDefault();
        alert('‡§ï‡•É‡§™‡§Ø‡§æ ‡§ò‡•ã‡§∑‡§£‡§æ‡§™‡§§‡•ç‡§∞ ‡§∏‡•ç‡§µ‡•Ä‡§ï‡§æ‡§∞‡§æ');
        return;
    }
    
    // Show confirmation
    if (!confirm('‡§§‡•Å‡§Æ‡•ç‡§π‡•Ä ‡§ñ‡§æ‡§§‡•ç‡§∞‡•Ä ‡§Ü‡§π‡§æ‡§§ ‡§ï‡•Ä ‡§∏‡§∞‡•ç‡§µ ‡§Æ‡§æ‡§π‡§ø‡§§‡•Ä ‡§Ø‡•ã‡§ó‡•ç‡§Ø ‡§Ü‡§π‡•á ‡§Ü‡§£‡§ø ‡§Ö‡§∞‡•ç‡§ú ‡§∏‡§¨‡§Æ‡§ø‡§ü ‡§ï‡§∞‡§æ‡§Ø‡§ö‡§æ ‡§Ü‡§π‡•á?')) {
        e.preventDefault();
        return;
    }
    
    // Show loading state
    const submitBtn = this.querySelector('button[type="submit"]');
    submitBtn.innerHTML = '<span class="spinner-border spinner-border-sm me-2"></span>‡§∏‡§¨‡§Æ‡§ø‡§ü ‡§ï‡§∞‡§§ ‡§Ü‡§π‡•á...';
    submitBtn.disabled = true;
});
</script>
{% endblock %}
