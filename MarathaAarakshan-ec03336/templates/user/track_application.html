{% extends "base.html" %}

{% block title %}‡§Ö‡§∞‡•ç‡§ú ‡§ü‡•ç‡§∞‡•Ö‡§ï‡§ø‡§Ç‡§ó - {{ application.application_number }}{% endblock %}

{% block content %}
<div class="container py-5">
    <!-- Header -->
    <div class="row mb-4">
        <div class="col-md-8">
            <h1 class="display-6 text-primary">üìä ‡§Ö‡§∞‡•ç‡§ú ‡§∏‡•ç‡§•‡§ø‡§§‡•Ä ‡§ü‡•ç‡§∞‡•Ö‡§ï‡§∞</h1>
            <p class="text-muted">‡§Ö‡§∞‡•ç‡§ú ‡§ï‡•ç‡§∞‡§Æ‡§æ‡§Ç‡§ï: <strong>{{ application.application_number }}</strong></p>
        </div>
        <div class="col-md-4 text-end">
            <div class="btn-group">
                <button class="btn btn-outline-primary" onclick="window.print()">
                    <i class="fas fa-print me-2"></i>‡§™‡•ç‡§∞‡§ø‡§Ç‡§ü ‡§ï‡§∞‡§æ
                </button>
                <button class="btn btn-outline-success" onclick="shareApplication()">
                    <i class="fas fa-share me-2"></i>‡§∂‡•á‡§Ö‡§∞ ‡§ï‡§∞‡§æ
                </button>
            </div>
        </div>
    </div>

    <!-- Application Info -->
    <div class="row mb-5">
        <div class="col-lg-8">
            <div class="card border-0 shadow">
                <div class="card-header bg-primary text-white">
                    <h5 class="mb-0">
                        <i class="fas fa-file-alt me-2"></i>‡§Ö‡§∞‡•ç‡§ú‡§æ‡§ö‡•Ä ‡§Æ‡§æ‡§π‡§ø‡§§‡•Ä
                    </h5>
                </div>
                <div class="card-body">
                    <div class="row">
                        <div class="col-md-6">
                            <p><strong>‡§Ö‡§∞‡•ç‡§ú‡§¶‡§æ‡§∞‡§æ‡§ö‡•á ‡§®‡§æ‡§µ:</strong> {{ application.applicant_name }} {{ application.applicant_surname }}</p>
                            <p><strong>‡§ó‡§æ‡§µ:</strong> {{ application.village.name }}, {{ application.village.district.name }}</p>
                            <p><strong>‡§∏‡§Ç‡§™‡§∞‡•ç‡§ï:</strong> {{ application.contact_number or '‡§â‡§™‡§≤‡§¨‡•ç‡§ß ‡§®‡§æ‡§π‡•Ä' }}</p>
                        </div>
                        <div class="col-md-6">
                            <p><strong>‡§∏‡§¨‡§Æ‡§ø‡§ü ‡§¶‡§ø‡§®‡§æ‡§Ç‡§ï:</strong> {{ application.date_submitted.strftime('%d/%m/%Y') }}</p>
                            <p><strong>‡§Ö‡§™‡•á‡§ï‡•ç‡§∑‡§ø‡§§ ‡§™‡•Ç‡§∞‡•ç‡§£‡§§‡§æ:</strong> {{ application.estimated_completion.strftime('%d/%m/%Y') if application.estimated_completion else '‡§®‡§ø‡§∂‡•ç‡§ö‡§ø‡§§ ‡§®‡§æ‡§π‡•Ä' }}</p>
                            <p><strong>‡§™‡•ç‡§∞‡§æ‡§ß‡§æ‡§®‡•ç‡§Ø:</strong> 
                                {% if application.priority == 'premium' %}
                                <span class="badge bg-warning">‡§™‡•ç‡§∞‡•Ä‡§Æ‡§ø‡§Ø‡§Æ</span>
                                {% else %}
                                <span class="badge bg-secondary">‡§∏‡§æ‡§Æ‡§æ‡§®‡•ç‡§Ø</span>
                                {% endif %}
                            </p>
                        </div>
                    </div>
                </div>
            </div>
        </div>

        <div class="col-lg-4">
            <div class="card border-0 shadow">
                <div class="card-header bg-success text-white">
                    <h5 class="mb-0">
                        <i class="fas fa-chart-pie me-2"></i>‡§è‡§ï‡•Ç‡§£ ‡§™‡•ç‡§∞‡§ó‡§§‡•Ä
                    </h5>
                </div>
                <div class="card-body text-center">
                    <div class="progress-circle mb-3" data-progress="{{ application.progress_percentage }}">
                        <div class="progress-circle-inner">
                            <span class="progress-percentage">{{ application.progress_percentage }}%</span>
                        </div>
                    </div>
                    <h6>‡§∏‡§ß‡•ç‡§Ø‡§æ‡§ö‡§æ ‡§ü‡§™‡•ç‡§™‡§æ: {{ application.current_stage|title }}</h6>
                    <p class="text-muted">
                        {% if application.status == 'submitted' %}
                        ‡§Ö‡§∞‡•ç‡§ú ‡§∏‡§¨‡§Æ‡§ø‡§ü ‡§ï‡•á‡§≤‡§æ ‡§ó‡•á‡§≤‡§æ ‡§Ü‡§π‡•á
                        {% elif application.status == 'under_review' %}
                        ‡§Ö‡§∞‡•ç‡§ú‡§æ‡§ö‡•Ä ‡§§‡§™‡§æ‡§∏‡§£‡•Ä ‡§∏‡•Å‡§∞‡•Ç ‡§Ü‡§π‡•á
                        {% elif application.status == 'approved' %}
                        ‡§Ö‡§∞‡•ç‡§ú ‡§Æ‡§Ç‡§ú‡•Ç‡§∞ ‡§ù‡§æ‡§≤‡§æ ‡§Ü‡§π‡•á
                        {% elif application.status == 'rejected' %}
                        ‡§Ö‡§∞‡•ç‡§ú ‡§®‡§æ‡§ï‡§æ‡§∞‡§≤‡§æ ‡§ó‡•á‡§≤‡§æ ‡§Ü‡§π‡•á
                        {% endif %}
                    </p>
                </div>
            </div>
        </div>
    </div>

    <!-- Progress Timeline -->
    <div class="row mb-5">
        <div class="col-12">
            <div class="card border-0 shadow">
                <div class="card-header bg-info text-white">
                    <h5 class="mb-0">
                        <i class="fas fa-route me-2"></i>‡§™‡•ç‡§∞‡§ï‡•ç‡§∞‡§ø‡§Ø‡§æ ‡§ü‡§æ‡§á‡§Æ‡§≤‡§æ‡§á‡§®
                    </h5>
                </div>
                <div class="card-body">
                    <div class="timeline-container">
                        {% for update in status_updates %}
                        <div class="timeline-item {{ 'completed' if loop.index <= application.progress_percentage / 20 else 'upcoming' }}">
                            <div class="timeline-marker">
                                {% if update.status == 'approved' or update.status == 'completed' %}
                                <i class="fas fa-check"></i>
                                {% elif update.status == 'in_progress' %}
                                <i class="fas fa-cog fa-spin"></i>
                                {% elif update.status == 'rejected' %}
                                <i class="fas fa-times"></i>
                                {% else %}
                                <i class="fas fa-clock"></i>
                                {% endif %}
                            </div>
                            <div class="timeline-content">
                                <div class="timeline-header">
                                    <h6>{{ update.stage|title }}</h6>
                                    <span class="badge bg-{{ 'success' if update.status == 'approved' else 'warning' if update.status == 'in_progress' else 'danger' if update.status == 'rejected' else 'secondary' }}">
                                        {{ update.status|title }}
                                    </span>
                                </div>
                                <p class="timeline-message">{{ update.message }}</p>
                                <div class="timeline-meta">
                                    <small class="text-muted">
                                        <i class="fas fa-calendar me-1"></i>{{ update.date_updated.strftime('%d/%m/%Y %H:%M') }}
                                        {% if update.updated_by %}
                                        | <i class="fas fa-user me-1"></i>{{ update.updated_by }}
                                        {% endif %}
                                    </small>
                                </div>
                            </div>
                        </div>
                        {% endfor %}
                    </div>
                </div>
            </div>
        </div>
    </div>

    <!-- Expected Timeline -->
    <div class="row mb-5">
        <div class="col-lg-6">
            <div class="card border-0 shadow">
                <div class="card-header bg-warning text-dark">
                    <h5 class="mb-0">
                        <i class="fas fa-clock me-2"></i>‡§Ö‡§™‡•á‡§ï‡•ç‡§∑‡§ø‡§§ ‡§µ‡•á‡§≥‡§æ‡§™‡§§‡•ç‡§∞‡§ï
                    </h5>
                </div>
                <div class="card-body">
                    <div class="timeline-expected">
                        <div class="timeline-step">
                            <strong>‡§ó‡•ç‡§∞‡§æ‡§Æ ‡§∏‡§Æ‡§ø‡§§‡•Ä (15-30 ‡§¶‡§ø‡§µ‡§∏)</strong>
                            <p>‡§∏‡•ç‡§•‡§æ‡§®‡§ø‡§ï ‡§§‡§™‡§æ‡§∏‡§£‡•Ä ‡§Ü‡§£‡§ø ‡§∏‡§§‡•ç‡§Ø‡§æ‡§™‡§®</p>
                        </div>
                        <div class="timeline-step">
                            <strong>‡§§‡§æ‡§≤‡•Å‡§ï‡§æ ‡§∏‡§Æ‡§ø‡§§‡•Ä (15-30 ‡§¶‡§ø‡§µ‡§∏)</strong>
                            <p>‡§ï‡§æ‡§ó‡§¶‡§™‡§§‡•ç‡§∞‡§æ‡§Ç‡§ö‡•Ä ‡§§‡§™‡§æ‡§∏‡§£‡•Ä</p>
                        </div>
                        <div class="timeline-step">
                            <strong>‡§ú‡§ø‡§≤‡•ç‡§π‡§æ ‡§∏‡§Æ‡§ø‡§§‡•Ä (30-45 ‡§¶‡§ø‡§µ‡§∏)</strong>
                            <p>‡§Ö‡§Ç‡§§‡§ø‡§Æ ‡§∏‡§§‡•ç‡§Ø‡§æ‡§™‡§® ‡§Ü‡§£‡§ø ‡§®‡§ø‡§∞‡•ç‡§£‡§Ø</p>
                        </div>
                        <div class="timeline-step">
                            <strong>‡§™‡•ç‡§∞‡§Æ‡§æ‡§£‡§™‡§§‡•ç‡§∞ ‡§ú‡§æ‡§∞‡•Ä (5-10 ‡§¶‡§ø‡§µ‡§∏)</strong>
                            <p>‡§Æ‡§Ç‡§ú‡•Å‡§∞‡•Ä‡§®‡§Ç‡§§‡§∞ ‡§™‡•ç‡§∞‡§Æ‡§æ‡§£‡§™‡§§‡•ç‡§∞ ‡§§‡§Ø‡§æ‡§∞ ‡§ï‡§∞‡§£‡•á</p>
                        </div>
                    </div>
                </div>
            </div>
        </div>

        <div class="col-lg-6">
            <div class="card border-0 shadow">
                <div class="card-header bg-danger text-white">
                    <h5 class="mb-0">
                        <i class="fas fa-exclamation-triangle me-2"></i>‡§Æ‡§π‡§§‡•ç‡§µ‡§æ‡§ö‡•ç‡§Ø‡§æ ‡§∏‡•Ç‡§ö‡§®‡§æ
                    </h5>
                </div>
                <div class="card-body">
                    <div class="alert alert-info">
                        <h6>‡§™‡•ç‡§∞‡§ï‡•ç‡§∞‡§ø‡§Ø‡§æ ‡§µ‡•á‡§ó‡§µ‡§æ‡§® ‡§ï‡§∞‡§£‡•ç‡§Ø‡§æ‡§∏‡§æ‡§†‡•Ä:</h6>
                        <ul class="mb-0">
                            <li>‡§∏‡§∞‡•ç‡§µ ‡§ï‡§æ‡§ó‡§¶‡§™‡§§‡•ç‡§∞‡•á ‡§Ø‡•ã‡§ó‡•ç‡§Ø ‡§Ü‡§£‡§ø ‡§∏‡•ç‡§™‡§∑‡•ç‡§ü ‡§Ö‡§∏‡§æ‡§µ‡•Ä‡§§</li>
                            <li>‡§∏‡§Ç‡§¨‡§Ç‡§ß‡§ø‡§§ ‡§ï‡§æ‡§∞‡•ç‡§Ø‡§æ‡§≤‡§Ø‡§æ‡§∂‡•Ä ‡§®‡§ø‡§Ø‡§Æ‡§ø‡§§ ‡§∏‡§Ç‡§™‡§∞‡•ç‡§ï ‡§†‡•á‡§µ‡§æ</li>
                            <li>‡§Ö‡§§‡§ø‡§∞‡§ø‡§ï‡•ç‡§§ ‡§ï‡§æ‡§ó‡§¶‡§™‡§§‡•ç‡§∞ ‡§Æ‡§æ‡§ó‡§ø‡§§‡§≤‡•ç‡§Ø‡§æ‡§∏ ‡§≤‡§ó‡•á‡§ö ‡§™‡•Å‡§∞‡§µ‡§æ</li>
                        </ul>
                    </div>

                    <div class="alert alert-warning">
                        <h6>‡§µ‡§ø‡§≤‡§Ç‡§¨ ‡§π‡•ã‡§ä ‡§∂‡§ï‡§§‡•ã ‡§ú‡§∞:</h6>
                        <ul class="mb-0">
                            <li>‡§ï‡§æ‡§ó‡§¶‡§™‡§§‡•ç‡§∞‡•á ‡§Ö‡§™‡•Ç‡§∞‡•ç‡§£ ‡§ï‡§ø‡§Ç‡§µ‡§æ ‡§ö‡•Å‡§ï‡•Ä‡§ö‡•Ä ‡§Ö‡§∏‡§§‡•Ä‡§≤</li>
                            <li>‡§Ö‡§§‡§ø‡§∞‡§ø‡§ï‡•ç‡§§ ‡§∏‡§§‡•ç‡§Ø‡§æ‡§™‡§® ‡§Ü‡§µ‡§∂‡•ç‡§Ø‡§ï ‡§Ö‡§∏‡•á‡§≤</li>
                            <li>‡§∏‡•Å‡§ü‡•ç‡§ü‡•Ä‡§ö‡•á ‡§¶‡§ø‡§µ‡§∏ ‡§ï‡§ø‡§Ç‡§µ‡§æ ‡§∏‡§∞‡§ï‡§æ‡§∞‡•Ä ‡§ï‡§æ‡§Æ‡§ï‡§æ‡§ú</li>
                        </ul>
                    </div>

                    {% if application.priority == 'normal' %}
                    <div class="text-center">
                        <a href="{% url 'accounts:premium_services' %}" class="btn btn-warning">
                            <i class="fas fa-rocket me-2"></i>‡§™‡•ç‡§∞‡§ï‡•ç‡§∞‡§ø‡§Ø‡§æ ‡§ú‡§≤‡§¶ ‡§ï‡§∞‡§æ
                        </a>
                    </div>
                    {% endif %}
                </div>
            </div>
        </div>
    </div>

    <!-- Contact and Support -->
    <div class="row">
        <div class="col-12">
            <div class="card border-0 shadow">
                <div class="card-header bg-secondary text-white">
                    <h5 class="mb-0">
                        <i class="fas fa-headset me-2"></i>‡§Æ‡§¶‡§§ ‡§Ü‡§£‡§ø ‡§∏‡§™‡•ã‡§∞‡•ç‡§ü
                    </h5>
                </div>
                <div class="card-body">
                    <div class="row">
                        <div class="col-md-4 text-center">
                            <i class="fas fa-phone fa-2x text-primary mb-3"></i>
                            <h6>‡§π‡•á‡§≤‡•ç‡§™‡§≤‡§æ‡§á‡§®</h6>
                            <p>+91 98765 43210</p>
                            <a href="tel:+919876543210" class="btn btn-outline-primary btn-sm">‡§ï‡•â‡§≤ ‡§ï‡§∞‡§æ</a>
                        </div>
                        <div class="col-md-4 text-center">
                            <i class="fab fa-whatsapp fa-2x text-success mb-3"></i>
                            <h6>WhatsApp ‡§∏‡§™‡•ã‡§∞‡•ç‡§ü</h6>
                            <p>‡§§‡•ç‡§µ‡§∞‡§ø‡§§ ‡§Æ‡§¶‡§§ ‡§Æ‡§ø‡§≥‡§µ‡§æ</p>
                            <a href="https://wa.me/919876543210?text=‡§Ö‡§∞‡•ç‡§ú ‡§ï‡•ç‡§∞‡§Æ‡§æ‡§Ç‡§ï: {{ application.application_number }}" class="btn btn-outline-success btn-sm" target="_blank">‡§Æ‡•á‡§∏‡•á‡§ú ‡§™‡§æ‡§†‡§µ‡§æ</a>
                        </div>
                        <div class="col-md-4 text-center">
                            <i class="fas fa-envelope fa-2x text-info mb-3"></i>
                            <h6>‡§à‡§Æ‡•á‡§≤ ‡§∏‡§™‡•ã‡§∞‡•ç‡§ü</h6>
                            <p>support@marathaarakshan.com</p>
                            <a href="mailto:support@marathaarakshan.com?subject=‡§Ö‡§∞‡•ç‡§ú ‡§ï‡•ç‡§∞‡§Æ‡§æ‡§Ç‡§ï: {{ application.application_number }}" class="btn btn-outline-info btn-sm">‡§à‡§Æ‡•á‡§≤ ‡§ï‡§∞‡§æ</a>
                        </div>
                    </div>
                </div>
            </div>
        </div>
    </div>
</div>

<style>
/* Progress Circle */
.progress-circle {
    width: 120px;
    height: 120px;
    border-radius: 50%;
    background: conic-gradient(var(--primary-color) calc(var(--progress) * 1%), #e9ecef 0);
    display: flex;
    align-items: center;
    justify-content: center;
    margin: 0 auto;
    position: relative;
}

.progress-circle-inner {
    width: 90px;
    height: 90px;
    border-radius: 50%;
    background: white;
    display: flex;
    align-items: center;
    justify-content: center;
    font-weight: bold;
    font-size: 1.2rem;
    color: var(--primary-color);
}

/* Timeline Styles */
.timeline-container {
    position: relative;
    padding-left: 40px;
}

.timeline-container::before {
    content: '';
    position: absolute;
    left: 20px;
    top: 0;
    bottom: 0;
    width: 2px;
    background: #dee2e6;
}

.timeline-item {
    position: relative;
    margin-bottom: 30px;
    padding-left: 50px;
}

.timeline-marker {
    position: absolute;
    left: -35px;
    top: 0;
    width: 40px;
    height: 40px;
    border-radius: 50%;
    display: flex;
    align-items: center;
    justify-content: center;
    color: white;
    font-size: 1.2rem;
    border: 3px solid white;
    box-shadow: 0 2px 10px rgba(0,0,0,0.1);
}

.timeline-item.completed .timeline-marker {
    background: #28a745;
}

.timeline-item.upcoming .timeline-marker {
    background: #6c757d;
}

.timeline-header {
    display: flex;
    justify-content: between;
    align-items: center;
    margin-bottom: 10px;
}

.timeline-header h6 {
    margin: 0;
    flex-grow: 1;
}

.timeline-message {
    margin-bottom: 10px;
    color: #666;
}

.timeline-meta {
    border-top: 1px solid #eee;
    padding-top: 10px;
}

/* Expected Timeline */
.timeline-expected .timeline-step {
    padding: 15px;
    border-left: 4px solid var(--primary-color);
    margin-bottom: 15px;
    background: #f8f9fa;
}

.timeline-expected .timeline-step:last-child {
    margin-bottom: 0;
}

/* Print Styles */
@media print {
    .btn-group, .card-header, .alert {
        display: none !important;
    }
    
    .card {
        border: 1px solid #ddd !important;
        box-shadow: none !important;
    }
}
</style>
{% endblock %}

{% block scripts %}
<script>
// Set progress circle
document.addEventListener('DOMContentLoaded', function() {
    const progressCircle = document.querySelector('.progress-circle');
    const progress = {{ application.progress_percentage }};
    progressCircle.style.setProperty('--progress', progress);
});

function shareApplication() {
    if (navigator.share) {
        navigator.share({
            title: '‡§Ö‡§∞‡•ç‡§ú ‡§∏‡•ç‡§•‡§ø‡§§‡•Ä - {{ application.application_number }}',
            text: '‡§Æ‡§æ‡§ù‡•ç‡§Ø‡§æ ‡§ï‡•Å‡§£‡§¨‡•Ä ‡§™‡•ç‡§∞‡§Æ‡§æ‡§£‡§™‡§§‡•ç‡§∞‡§æ‡§ö‡•ç‡§Ø‡§æ ‡§Ö‡§∞‡•ç‡§ú‡§æ‡§ö‡•Ä ‡§∏‡•ç‡§•‡§ø‡§§‡•Ä ‡§™‡§π‡§æ',
            url: window.location.href
        });
    } else {
        // Fallback
        navigator.clipboard.writeText(window.location.href).then(() => {
            alert('‡§≤‡§ø‡§Ç‡§ï ‡§ï‡•â‡§™‡•Ä ‡§ï‡•á‡§≤‡•Ä ‡§ó‡•á‡§≤‡•Ä!');
        });
    }
}

// Auto-refresh every 5 minutes
setInterval(function() {
    if (!document.hidden) {
        location.reload();
    }
}, 300000);

// Show estimated completion notification
{% if application.estimated_completion %}
const estimatedDate = new Date('{{ application.estimated_completion.isoformat() }}');
const today = new Date();
const daysLeft = Math.ceil((estimatedDate - today) / (1000 * 60 * 60 * 24));

if (daysLeft > 0 && daysLeft <= 7) {
    setTimeout(() => {
        alert(`üïí ‡§§‡•Å‡§Æ‡§ö‡§æ ‡§Ö‡§∞‡•ç‡§ú ${daysLeft} ‡§¶‡§ø‡§µ‡§∏‡§æ‡§Ç‡§§ ‡§™‡•Ç‡§∞‡•ç‡§£ ‡§π‡•ã‡§£‡•ç‡§Ø‡§æ‡§ö‡•Ä ‡§Ö‡§™‡•á‡§ï‡•ç‡§∑‡§æ ‡§Ü‡§π‡•á!`);
    }, 2000);
}
{% endif %}
</script>
{% endblock %}
